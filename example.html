<!doctype html>
<html>
    <head>
        <title>Map class supporting labels for Leaflet</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
        <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
        <link rel="stylesheet" href="leaflet-mapwithlabels.css" />
        <script src="leaflet-mapwithlabels.js"></script>
        <style>
            html, body {
                height: 100%;
                margin: 0;
            }
            #map_div {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
    <body>
        <div id="map_div"></div>
        <script>
            // list object properties in html format
            let props = o => {
                let s = '';
                for (let i in o) s += i + ': ' + o[i] + '<br/>';
                return s;
            }

            // create map object
            const map = L.mapWithLabels('map_div').fitBounds([[45.7, 16.1], [48.6, 22.9]]);
            
            // create map panes
            map.createPane('hydroPane').style.zIndex = 410;
            map.createPane('roadPane').style.zIndex = 420;
            map.createPane('settlPane').style.zIndex = 430;
            	
            function polyColor(f) {
				let p=f.properties.Nepesseg;
                let r=Math.random()*150+100;
                let g=Math.random()*150+100;
                let b=Math.random()*150+100;
                return { fillColor: `rgb(${r},${g},${b})`, fillOpacity: .7, color: 'black', opacity: 1, weight: 1 };
            }                  
			
            // counties of Hungary
            fetch('hu_megyek.geojson').then(r => r.json()).then(d => {
                L.geoJSON(d, {
                    label: l=>l.feature.properties.Nev, 
                    labelPos: 'cc', 
                    labelStyle: { fontWeight: 'bold', whiteSpace: 'normal', minWidth: '120px', textAlign: 'center'},
                    labelPriority: l=>l.feature.properties.Nepesseg,
                    style: polyColor
                }).addTo(map).bindPopup(l => props(l.feature.properties));
            });
            
            // hydorgraphy
            const hydroStyle = { color: 'blue', opacity: 1, fillColor: '#88f', fillOpacity: 1, weight: 1 };
            const hydroLabelStyle = { color: 'blue', fontStyle: 'italic', textAlign: 'center'};

            // large rivers
            fetch('folyok_poly.geojson').then(r => r.json()).then(d => {
                L.geoJSON(d, {
                    label: l=>l.feature.properties.Nev, 
                    labelPos: 'cc', 
                    labelStyle: hydroLabelStyle,
                    labelPriority: 1e5,
                    pane: 'hydroPane',
                    style: hydroStyle
                }).addTo(map).bindPopup(l => props(l.feature.properties));
            });

            // large lakes
            fetch('nagytavak.geojson').then(r => r.json()).then(d => {
                L.geoJSON(d, {
                    label: l=>l.feature.properties.Nev, 
                    labelPos: 'cc', 
                    labelStyle: hydroLabelStyle,
                    labelPriority: 1e5,
                    pane: 'hydroPane',
                    style: hydroStyle
                }).addTo(map).bindPopup(l => props(l.feature.properties));
            });
            
            // minor rivers
            fetch('folyok.geojson').then(r => r.json()).then(d => {
                L.geoJSON(d, {
                    label: l=>l.feature.properties.Nev, 
                    labelPos: 'cc', 
                    labelStyle: hydroLabelStyle,
                    labelPriority: 1e4,
                    pane: 'hydroPane',
                    style: hydroStyle
                }).addTo(map).bindPopup(l => props(l.feature.properties));
            });
           
            // main road network
            fetch('utak.geojson').then(r => r.json()).then(d => {
                L.geoJSON(d, {
                    label: l=>l.feature.properties.szam.replace(';','<br/>'), 
                    labelPriority: l=>l.feature.properties.szam.startsWith('M')?2:1,
                    labelPos: 'cc', 
                    labelStyle: l=>({ 
                        background: l.feature.properties.szam.startsWith('M')?'blue':'green', 
                        border: 'solid 2px white', padding: '0 5px',
                        borderRadius: '6px', color: 'white', textShadow: 'none', textAlign: 'center'
                    }),
                    pane: 'roadPane',
                    style: f=>f.properties.szam.startsWith('M')?{ color: 'red', opacity: 1, weight: 5 }:{ color: 'orange', opacity: 1, weight: 3 },
                }).addTo(map).bindPopup(l => props(l.feature.properties));
            });

            // settlements
            fetch('hu_settl.geojson').then(r => r.json()).then(d => {
                L.geoJSON(d, {
                    markersInheritOptions: true,
                    pointToLayer: (gj, ll) => L.circleMarker(ll, {
                        radius: gj.properties.population?Math.pow(gj.properties.population,.2)-1:1,
                        labelStyle: l => (l.feature.properties.place=='city'?{ textTransform: 'uppercase', fontWeight:'bold' }:{}),
                        labelPriority: l => l.feature.properties.population,
                        markerWithLabelOnly: true,
                        pane: 'settlPane',
                        label: l => l.feature.properties.name
                    }), 
                    style: f => ({ color: '#000', fillColor: '#fff', fillOpacity: .6, weight: f.properties.place=='city'?3:1 })
                }).addTo(map).bindPopup(l => props(l.feature.properties));
            });           
        </script>
    </body>
</html>